<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
"http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="dashboard">
	<typeAlias alias="dashboardBean"
		type="adins.ace.taps.bean.dashboard.DashboardBean" />

	<select id="searchTopTen" resultClass="dashboardBean">
		SELECT * 
		FROM (	SELECT 	e.user_domain AS userDomain, 
						e.employee_code, e.first_name ||' '|| e.last_name as employeeName,
						SUM (s.star_after) - SUM (s.star_before) AS totalStar
						FROM employees e, stars s
				WHERE 	e.user_domain = s.user_domain 
				GROUP BY e.user_domain, e.employee_code, e.first_name ||' '|| e.last_name
				ORDER BY totalStar DESC)
		WHERE <![CDATA[ROWNUM <= 10]]>
	</select>

	<select id="searchTopTenOrganization" resultClass="dashboardBean">
		SELECT   *
		FROM   (  SELECT   	e.user_domain AS userDomain, 
							e.employee_code, e.first_name ||' '|| e.last_name as employeeName,
		                   	SUM (s.star_after) - SUM (s.star_before) AS totalStar
		            FROM   	employees e, stars s
		           WHERE   	e.user_domain = s.user_domain  AND UPPER(E.ORGANIZATION_CODE) = UPPER(#organizationCOde#)
		        GROUP BY   	e.user_domain, e.employee_code, e.first_name ||' '|| e.last_name
		        ORDER BY   	totalStar DESC)
		WHERE   <![CDATA[ROWNUM <= 10]]>
	</select>
	<select id="getPhotoEmployees" resultClass="adins.ace.taps.bean.dashboard.DashboardBean"
		parameterClass="java.lang.String">
		SELECT picture AS profilePicture from employees WHERE
		user_domain=#employeeDomain#
	</select>
	
</sqlMap>
