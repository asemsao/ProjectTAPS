<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
"http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="employee">
	<typeAlias alias="employeeBean" type="adins.ace.taps.bean.employee.EmployeeBean" />

	<select id="countEmployees" resultClass="int" parameterClass="java.util.Map">
		SELECT COUNT(1)
		FROM employees e
	</select>
	
	<select id="searchEmployees" resultClass="employeeBean"
		parameterClass="java.util.Map">
		SELECT *
		FROM (SELECT ROWNUM seqnum, a.*
		FROM (SELECT EMPLOYEE_CODE AS
		employeeCode, USER_DOMAIN AS employeeDomain,
		EMPLOYEE_NIK AS
		employeeNik,
		FIRST_NAME||' '||LAST_NAME AS employeeName,
		ADDRESS AS
		employeeAddress
		FROM EMPLOYEES 
		<dynamic prepend="WHERE">
					<isNotNull property="keyword">
						<isNotEmpty property="keyword">
							<isEqual property="category" compareValue="employeeDomain">(LOWER(USER_DOMAIN)
								LIKE LOWER ('%$keyword$%'))</isEqual>
							<isEqual property="category" compareValue="employeeCode">(LOWER(EMPLOYEE_CODE)
								LIKE LOWER ('%$keyword$%'))</isEqual>
							<isEqual property="category" compareValue="employeeName">(LOWER(FIRST_NAME) 
								LIKE LOWER ('%$keyword$%') OR
								LOWER(LAST_NAME) LIKE LOWER ('%$keyword$%'))
							</isEqual>
							<isEqual property="category" compareValue="employeeAddress">(LOWER(ADDRESS) 
								LIKE LOWER ('%$keyword$%'))
							</isEqual>
							<isEqual property="category" compareValue="All">(LOWER(USER_DOMAIN)
								LIKE LOWER ('%$keyword$%') OR LOWER(EMPLOYEE_CODE)
								LIKE LOWER ('%$keyword$%') OR LOWER(FIRST_NAME) 
								LIKE LOWER ('%$keyword$%') OR
								LOWER(LAST_NAME) LIKE LOWER ('%$keyword$%') OR LOWER(ADDRESS) 
								LIKE LOWER ('%$keyword$%'))
							</isEqual>
						</isNotEmpty>
					</isNotNull>
				</dynamic>
		) a WHERE  <![CDATA[ ROWNUM <= #end#]]>)
		WHERE  <![CDATA[ seqnum >= #start#]]>
	</select>
	<select id="getEditEmployees" resultClass="adins.ace.taps.bean.employee.NewEmployeeBean"
		parameterClass="java.util.Map">
		SELECT picture AS profilePicture, user_domain AS
		employeeDomain, employee_nik AS employeeNik, employee_code AS
		employeeCode,
		first_name AS firstName,
		last_name AS lastName, gender AS
		gender, organization_code AS businessUnit, address AS employeeAddress,
		phone_number AS phoneNumber,
		mobile_phone AS mobileNumber, email AS
		email,
		SUBSTR(employee_category,1,1) AS golonganNumber,
		SUBSTR(employee_category,2,2) AS golonganLevel, flag AS flag FROM
		employees where user_domain = UPPER(#employeeDomain#)
	</select>
	<select id="addEmployee" parameterClass="adins.ace.taps.bean.employee.NewEmployeeBean">
		INSERT INTO
		employees(picture, user_domain, employee_nik, employee_code,
		first_name,
		last_name, gender, organization_code, address,
		phone_number,
		mobile_phone, email,
		employee_category, flag, created_by,
		created_date, updated_by,updated_date)
		VALUES(#profilePicture#,#employeeDomain#,#employeeNik#,#employeeCode#,#firstName#,#lastName#,
		#gender#,'MAN',#employeeAddress#,#phoneNumber#,#mobileNumber#,#email#,#golonganNumber#
		|| #golonganLevel#,'ACTIVE','DOMAIN201',SYSDATE,'DOMAIN201',SYSDATE)
	</select>
</sqlMap>
